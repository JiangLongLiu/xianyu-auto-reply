# å‡çº§ç»´æŠ¤æ“ä½œæŒ‡å—

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [docker-deploy.sh](file://docker-deploy.sh)
- [docker-deploy.bat](file://docker-deploy.bat)
- [entrypoint.sh](file://entrypoint.sh)
- [Dockerfile](file://Dockerfile)
- [docker-compose.yml](file://docker-compose.yml)
- [update_log.txt](file://static/update_log.txt)
- [config.py](file://config.py)
- [db_manager.py](file://db_manager.py)
- [reply_server.py](file://reply_server.py)
</cite>

## ç›®å½•
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ç‰ˆæœ¬å˜æ›´å†å²è·Ÿè¸ª](#ç‰ˆæœ¬å˜æ›´å†å²è·Ÿè¸ª)
3. [ä¸€é”®éƒ¨ç½²è„šæœ¬ä½¿ç”¨](#ä¸€é”®éƒ¨ç½²è„šæœ¬ä½¿ç”¨)
4. [æ•°æ®åº“è¿ç§»æœºåˆ¶](#æ•°æ®åº“è¿ç§»æœºåˆ¶)
5. [ç‰ˆæœ¬å‡çº§æµç¨‹](#ç‰ˆæœ¬å‡çº§æµç¨‹)
6. [å¤‡ä»½ä¸æ¢å¤](#å¤‡ä»½ä¸æ¢å¤)
7. [ç³»ç»Ÿç»´æŠ¤æ£€æŸ¥](#ç³»ç»Ÿç»´æŠ¤æ£€æŸ¥)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [å®šæœŸç»´æŠ¤è®¡åˆ’](#å®šæœŸç»´æŠ¤è®¡åˆ’)

## æ¦‚è¿°

æœ¬ç³»ç»Ÿé‡‡ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²æ¶æ„ï¼Œæä¾›äº†å®Œæ•´çš„å‡çº§ç»´æŠ¤è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬å’Œæ™ºèƒ½çš„æ•°æ®åº“è¿ç§»æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿå‡çº§è¿‡ç¨‹çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šæ”¯æŒLinuxå’ŒWindowså¹³å°çš„ä¸€é”®éƒ¨ç½²
- **æ™ºèƒ½è¿ç§»**ï¼šè‡ªåŠ¨å¤„ç†æ•°æ®åº“ç»“æ„å˜æ›´å’Œæ–‡ä»¶è¿ç§»
- **æ•°æ®ä¿æŠ¤**ï¼šå®Œå–„çš„å¤‡ä»½æ¢å¤æœºåˆ¶
- **å¥åº·ç›‘æ§**ï¼šå®æ—¶å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç›‘æ§
- **ç‰ˆæœ¬è¿½è¸ª**ï¼šè¯¦ç»†çš„å˜æ›´å†å²è®°å½•

## ç‰ˆæœ¬å˜æ›´å†å²è·Ÿè¸ª

### update_log.txtæ–‡ä»¶ç»“æ„

ç³»ç»Ÿé€šè¿‡`static/update_log.txt`æ–‡ä»¶è®°å½•ç‰ˆæœ¬å˜æ›´å†å²ï¼Œè¯¥æ–‡ä»¶ä½äºé™æ€èµ„æºç›®å½•ä¸­ã€‚

```mermaid
graph TD
A["update_log.txt"] --> B["åŠŸèƒ½æ›´æ–°è®°å½•"]
A --> C["æ€§èƒ½ä¼˜åŒ–è®°å½•"]
A --> D["ç¼ºé™·ä¿®å¤è®°å½•"]
B --> E["æ–°å¢åŠŸèƒ½ç‰¹æ€§"]
B --> F["APIæ¥å£æ”¹è¿›"]
C --> G["å“åº”é€Ÿåº¦ä¼˜åŒ–"]
C --> H["å†…å­˜ä½¿ç”¨ä¼˜åŒ–"]
D --> I["Bugä¿®å¤"]
D --> J["å…¼å®¹æ€§æ”¹è¿›"]
```

**å›¾è¡¨æ¥æº**
- [update_log.txt](file://static/update_log.txt#L1-L10)

### å˜æ›´è®°å½•æ ¼å¼

æ¯ä¸ªç‰ˆæœ¬å˜æ›´è®°å½•éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š
- âœ¨ æ–°å¢åŠŸèƒ½
- ğŸ› ç¼ºé™·ä¿®å¤
- ğŸš€ æ€§èƒ½ä¼˜åŒ–
- ğŸ”§ é…ç½®è°ƒæ•´

**ç« èŠ‚æ¥æº**
- [update_log.txt](file://static/update_log.txt#L1-L10)

## ä¸€é”®éƒ¨ç½²è„šæœ¬ä½¿ç”¨

### Linuxéƒ¨ç½²è„šæœ¬ (docker-deploy.sh)

#### åŠŸèƒ½æ¦‚è§ˆ

```mermaid
flowchart TD
A["docker-deploy.sh"] --> B["ä¾èµ–æ£€æŸ¥"]
A --> C["é…ç½®åˆå§‹åŒ–"]
A --> D["é•œåƒæ„å»º"]
A --> E["æœåŠ¡å¯åŠ¨"]
B --> F["Dockeræ£€æŸ¥"]
B --> G["Docker Composeæ£€æŸ¥"]
C --> H["æ–‡ä»¶æ£€æŸ¥"]
C --> I["ç›®å½•åˆ›å»º"]
D --> J["æ ‡å‡†é•œåƒæ„å»º"]
D --> K["å›½å†…é•œåƒæ„å»º"]
E --> L["åŸºç¡€æœåŠ¡å¯åŠ¨"]
E --> M["Nginxé›†æˆå¯åŠ¨"]
```

**å›¾è¡¨æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L36-L117)

#### å‘½ä»¤ä½¿ç”¨è¯´æ˜

| å‘½ä»¤ | åŠŸèƒ½æè¿° | å‚æ•° |
|------|----------|------|
| `./docker-deploy.sh init` | åˆå§‹åŒ–é…ç½®æ–‡ä»¶ | æ—  |
| `./docker-deploy.sh build` | æ„å»ºDockeré•œåƒ | æ—  |
| `./docker-deploy.sh start` | å¯åŠ¨åŸºç¡€æœåŠ¡ | æ—  |
| `./docker-deploy.sh start with-nginx` | å¯åŠ¨åŒ…å«Nginxçš„æœåŠ¡ | with-nginx |
| `./docker-deploy.sh stop` | åœæ­¢æœåŠ¡ | æ—  |
| `./docker-deploy.sh restart` | é‡å¯æœåŠ¡ | æ—  |
| `./docker-deploy.sh status` | æŸ¥çœ‹æœåŠ¡çŠ¶æ€ | æ—  |
| `./docker-deploy.sh logs` | æŸ¥çœ‹æœåŠ¡æ—¥å¿— | [service] |
| `./docker-deploy.sh health` | å¥åº·æ£€æŸ¥ | æ—  |
| `./docker-deploy.sh backup` | å¤‡ä»½æ•°æ® | æ—  |
| `./docker-deploy.sh update` | æ›´æ–°éƒ¨ç½² | æ—  |
| `./docker-deploy.sh cleanup` | æ¸…ç†ç¯å¢ƒ | æ—  |

#### éƒ¨ç½²æµç¨‹è¯¦è§£

1. **ä¾èµ–æ£€æŸ¥é˜¶æ®µ**
   - éªŒè¯Dockerå’ŒDocker Composeå®‰è£…
   - æ£€æŸ¥å¿…è¦æ–‡ä»¶å­˜åœ¨æ€§
   - åˆ›å»ºå¿…éœ€ç›®å½•ç»“æ„

2. **é•œåƒæ„å»ºé˜¶æ®µ**
   - é€‰æ‹©æ„å»ºæ–¹å¼ï¼ˆæ ‡å‡†/å›½å†…é•œåƒï¼‰
   - æ‰§è¡ŒDockeré•œåƒæ„å»º
   - éªŒè¯æ„å»ºç»“æœ

3. **æœåŠ¡å¯åŠ¨é˜¶æ®µ**
   - å¯åŠ¨ä¸»åº”ç”¨æœåŠ¡
   - å¯é€‰å¯åŠ¨Nginxåå‘ä»£ç†
   - æ‰§è¡Œå¥åº·æ£€æŸ¥
   - æ˜¾ç¤ºè®¿é—®ä¿¡æ¯

**ç« èŠ‚æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L36-L361)

### Windowséƒ¨ç½²è„šæœ¬ (docker-deploy.bat)

#### åŠŸèƒ½å¯¹æ¯”

Windowsç‰ˆæœ¬æä¾›ä¸Linuxç‰ˆæœ¬ç›¸åŒçš„åŠŸèƒ½é›†åˆï¼Œä½†é’ˆå¯¹Windowsç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ï¼š

```mermaid
graph LR
A["docker-deploy.bat"] --> B["Windowså…¼å®¹æ€§"]
A --> C["æ‰¹å¤„ç†ä¼˜åŒ–"]
A --> D["é”™è¯¯å¤„ç†"]
B --> E["CMDå‘½ä»¤æ”¯æŒ"]
B --> F["è·¯å¾„å¤„ç†"]
C --> G["å»¶è¿Ÿå˜é‡æ‰©å±•"]
C --> H["æ¡ä»¶åˆ¤æ–­"]
D --> I["é”™è¯¯çº§åˆ«æ£€æŸ¥"]
D --> J["ç”¨æˆ·æç¤º"]
```

**å›¾è¡¨æ¥æº**
- [docker-deploy.bat](file://docker-deploy.bat#L20-L67)

#### ä½¿ç”¨æ–¹æ³•

```bash
# å¿«é€Ÿéƒ¨ç½²
docker-deploy.bat

# å¯åŠ¨æœåŠ¡
docker-deploy.bat start

# æŸ¥çœ‹çŠ¶æ€
docker-deploy.bat status

# æŸ¥çœ‹æ—¥å¿—
docker-deploy.bat logs

# å¥åº·æ£€æŸ¥
docker-deploy.bat health
```

**ç« èŠ‚æ¥æº**
- [docker-deploy.bat](file://docker-deploy.bat#L70-L229)

## æ•°æ®åº“è¿ç§»æœºåˆ¶

### entrypoint.shä¸­çš„è¿ç§»é€»è¾‘

ç³»ç»Ÿåœ¨å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Œç¡®ä¿æ•°æ®ç»“æ„çš„å…¼å®¹æ€§ã€‚

```mermaid
sequenceDiagram
participant Container as "Dockerå®¹å™¨"
participant Entrypoint as "entrypoint.sh"
participant DB as "æ•°æ®åº“"
participant Files as "æ–‡ä»¶ç³»ç»Ÿ"
Container->>Entrypoint : å®¹å™¨å¯åŠ¨
Entrypoint->>Files : æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
Files-->>Entrypoint : æ–‡ä»¶çŠ¶æ€
alt å‘ç°æ—§æ•°æ®åº“æ–‡ä»¶
Entrypoint->>Files : è¿ç§»æ–‡ä»¶åˆ°/dataç›®å½•
Files-->>Entrypoint : è¿ç§»å®Œæˆ
end
Entrypoint->>DB : æ‰§è¡Œæ•°æ®åº“è¿ç§»
DB-->>Entrypoint : è¿ç§»ç»“æœ
Entrypoint->>Container : å¯åŠ¨åº”ç”¨
```

**å›¾è¡¨æ¥æº**
- [entrypoint.sh](file://entrypoint.sh#L51-L75)

### è¿ç§»åŠŸèƒ½è¯¦è§£

#### 1. æ•°æ®åº“æ–‡ä»¶è¿ç§»

ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶è¿ç§»ä»¥ä¸‹æ–‡ä»¶ï¼š
- `/app/xianyu_data.db` â†’ `/app/data/xianyu_data.db`
- `/app/user_stats.db` â†’ `/app/data/user_stats.db`
- `/app/xianyu_data_backup_*.db` â†’ `/app/data/`

#### 2. æ•°æ®åº“ç»“æ„å‡çº§

```mermaid
flowchart TD
A["æ•°æ®åº“åˆå§‹åŒ–"] --> B["æ£€æŸ¥ç‰ˆæœ¬"]
B --> C["æ‰§è¡Œå‡çº§"]
C --> D["è¿ç§»é—ç•™æ•°æ®"]
C --> E["ç‰ˆæœ¬1.0 â†’ 1.1"]
C --> F["ç‰ˆæœ¬1.1 â†’ 1.2"]
C --> G["ç‰ˆæœ¬1.2 â†’ 1.3"]
C --> H["ç‰ˆæœ¬1.3 â†’ 1.4"]
C --> I["ç‰ˆæœ¬1.4 â†’ 1.5"]
E --> J["é€šçŸ¥æ¸ é“å‡çº§"]
F --> K["é€šçŸ¥æ¸ é“ç±»å‹æ‰©å±•"]
G --> L["å…³é”®è¯å›¾ç‰‡æ”¯æŒ"]
H --> M["é€šçŸ¥æ¸ é“ç±»å‹æ‰©å±•"]
I --> N["è´¦å·ç™»å½•æ”¯æŒ"]
```

**å›¾è¡¨æ¥æº**
- [db_manager.py](file://db_manager.py#L557-L611)

#### 3. å­—æ®µè‡ªåŠ¨æ·»åŠ 

ç³»ç»Ÿè‡ªåŠ¨ä¸ºç°æœ‰è¡¨æ·»åŠ æ–°å­—æ®µï¼š
- `cards`è¡¨ï¼š`user_id`, `delay_seconds`, `is_multi_spec`, `spec_name`, `spec_value`
- `cookies`è¡¨ï¼š`remark`, `pause_duration`, `username`, `password`
- `keywords`è¡¨ï¼š`item_id`
- `item_info`è¡¨ï¼š`multi_quantity_delivery`

**ç« èŠ‚æ¥æº**
- [entrypoint.sh](file://entrypoint.sh#L51-L75)
- [db_manager.py](file://db_manager.py#L557-L611)

## ç‰ˆæœ¬å‡çº§æµç¨‹

### å®Œæ•´å‡çº§æ­¥éª¤

```mermaid
flowchart TD
A["å¼€å§‹å‡çº§"] --> B["å¤‡ä»½å½“å‰æ•°æ®"]
B --> C["åœæ­¢æœåŠ¡"]
C --> D["æ‹‰å–æœ€æ–°ä»£ç "]
D --> E["æ„å»ºæ–°é•œåƒ"]
E --> F["å¯åŠ¨æ–°æœåŠ¡"]
F --> G["å¥åº·æ£€æŸ¥"]
G --> H{"æ£€æŸ¥é€šè¿‡?"}
H --> |æ˜¯| I["å‡çº§å®Œæˆ"]
H --> |å¦| J["å›æ»šæ“ä½œ"]
J --> K["æ¢å¤å¤‡ä»½"]
K --> L["å¯åŠ¨æ—§ç‰ˆæœ¬"]
```

**å›¾è¡¨æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L225-L248)

### å‡çº§å‰å‡†å¤‡

1. **æ£€æŸ¥ç³»ç»ŸçŠ¶æ€**
   ```bash
   # Linux
   ./docker-deploy.sh health
   
   # Windows
   docker-deploy.bat health
   ```

2. **æ‰‹åŠ¨å¤‡ä»½é‡è¦æ•°æ®**
   ```bash
   # Linux
   ./docker-deploy.sh backup
   
   # Windows
   docker-deploy.bat backup
   ```

### è‡ªåŠ¨åŒ–å‡çº§æµç¨‹

#### 1. ä½¿ç”¨updateå‘½ä»¤

```bash
# Linux
./docker-deploy.sh update

# Windows
docker-deploy.bat update
```

#### 2. å‡çº§è¿‡ç¨‹ç›‘æ§

å‡çº§è¿‡ç¨‹ä¸­ç³»ç»Ÿä¼šï¼š
- è‡ªåŠ¨å¤‡ä»½å½“å‰æ•°æ®åˆ°`backups/YYYYMMDD_HHMMSS/`ç›®å½•
- åœæ­¢ç°æœ‰æœåŠ¡
- æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰
- é‡æ–°æ„å»ºDockeré•œåƒ
- å¯åŠ¨æ–°ç‰ˆæœ¬æœåŠ¡
- æ‰§è¡Œå¥åº·æ£€æŸ¥

**ç« èŠ‚æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L225-L248)

## å¤‡ä»½ä¸æ¢å¤

### è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

ç³»ç»Ÿæä¾›è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ï¼Œæ”¯æŒå®šæ—¶å’Œæ‰‹åŠ¨å¤‡ä»½ã€‚

```mermaid
graph TD
A["å¤‡ä»½è§¦å‘"] --> B["åˆ›å»ºå¤‡ä»½ç›®å½•"]
B --> C["å¤‡ä»½æ•°æ®åº“æ–‡ä»¶"]
B --> D["å¤‡ä»½é…ç½®æ–‡ä»¶"]
B --> E["å¤‡ä»½å…¶ä»–æ•°æ®"]
C --> F["xianyu_data.db"]
C --> G["user_stats.db"]
D --> H["global_config.yml"]
D --> I["ç¯å¢ƒå˜é‡æ–‡ä»¶"]
E --> J["ä¸Šä¼ çš„å›¾ç‰‡"]
E --> K["æ—¥å¿—æ–‡ä»¶"]
```

**å›¾è¡¨æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L205-L222)

### å¤‡ä»½å†…å®¹è¯¦æƒ…

| å¤‡ä»½é¡¹ç›® | æ–‡ä»¶è·¯å¾„ | å¤‡ä»½é¢‘ç‡ | ä¿ç•™æœŸé™ |
|----------|----------|----------|----------|
| ä¸»æ•°æ®åº“ | `data/xianyu_data.db` | æ¯æ¬¡å‡çº§å‰ | 30å¤© |
| ç»Ÿè®¡æ•°æ®åº“ | `data/user_stats.db` | æ¯æ¬¡å‡çº§å‰ | 30å¤© |
| é…ç½®æ–‡ä»¶ | `global_config.yml` | æ¯æ¬¡å‡çº§å‰ | æ°¸ä¹… |
| ä¸Šä¼ å›¾ç‰‡ | `static/uploads/images/` | æ‰‹åŠ¨ | 30å¤© |
| æ—¥å¿—æ–‡ä»¶ | `logs/` | æ‰‹åŠ¨ | 7å¤© |

### æ‰‹åŠ¨å¤‡ä»½æ“ä½œ

```bash
# åˆ›å»ºå¤‡ä»½
./docker-deploy.sh backup

# æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
ls -la backups/

# æ¢å¤ç‰¹å®šå¤‡ä»½
# 1. åœæ­¢æœåŠ¡
./docker-deploy.sh stop

# 2. æ¢å¤æ•°æ®
cp backups/YYYYMMDD_HHMMSS/xianyu_data.db data/
cp backups/YYYYMMDD_HHMMSS/global_config.yml .

# 3. é‡å¯æœåŠ¡
./docker-deploy.sh start
```

### æ•°æ®æ¢å¤æµç¨‹

```mermaid
sequenceDiagram
participant Admin as "ç®¡ç†å‘˜"
participant Script as "æ¢å¤è„šæœ¬"
participant DB as "æ•°æ®åº“"
participant Files as "æ–‡ä»¶ç³»ç»Ÿ"
Admin->>Script : è§¦å‘æ¢å¤
Script->>DB : åœæ­¢æ•°æ®åº“æœåŠ¡
Script->>Files : å¤‡ä»½å½“å‰æ•°æ®
Script->>Files : æ¢å¤å¤‡ä»½æ–‡ä»¶
Script->>DB : å¯åŠ¨æ•°æ®åº“æœåŠ¡
Script->>Admin : æ¢å¤å®Œæˆ
```

**ç« èŠ‚æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L205-L222)

## ç³»ç»Ÿç»´æŠ¤æ£€æŸ¥

### å¥åº·æ£€æŸ¥æœºåˆ¶

ç³»ç»Ÿæä¾›å¤šå±‚æ¬¡çš„å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼š

```mermaid
graph TD
A["å¥åº·æ£€æŸ¥"] --> B["æœåŠ¡çŠ¶æ€æ£€æŸ¥"]
A --> C["æ•°æ®åº“è¿æ¥æ£€æŸ¥"]
A --> D["èµ„æºä½¿ç”¨æ£€æŸ¥"]
A --> E["APIå¯ç”¨æ€§æ£€æŸ¥"]
B --> F["å®¹å™¨è¿è¡ŒçŠ¶æ€"]
B --> G["è¿›ç¨‹å­˜æ´»çŠ¶æ€"]
C --> H["SQLiteè¿æ¥"]
C --> I["è¡¨ç»“æ„éªŒè¯"]
D --> J["CPUä½¿ç”¨ç‡"]
D --> K["å†…å­˜ä½¿ç”¨ç‡"]
D --> L["ç£ç›˜ç©ºé—´"]
E --> M["/healthç«¯ç‚¹"]
E --> N["APIå“åº”æ—¶é—´"]
```

**å›¾è¡¨æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L182-L203)

### æ£€æŸ¥é¡¹ç›®æ¸…å•

#### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./docker-deploy.sh status

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
./docker-deploy.sh logs xianyu-app

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
./docker-deploy.sh logs
```

#### 2. èµ„æºä½¿ç”¨ç›‘æ§
```bash
# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
./docker-deploy.sh status

# æŸ¥çœ‹å®æ—¶èµ„æºç»Ÿè®¡
docker stats $(docker-compose ps -q)
```

#### 3. æ•°æ®åº“å¥åº·æ£€æŸ¥
- éªŒè¯æ•°æ®åº“è¿æ¥
- æ£€æŸ¥è¡¨ç»“æ„å®Œæ•´æ€§
- éªŒè¯å…³é”®æ•°æ®è®°å½•

#### 4. åº”ç”¨åŠŸèƒ½æµ‹è¯•
- APIç«¯ç‚¹å¯ç”¨æ€§
- WebSocketè¿æ¥çŠ¶æ€
- å…³é”®ä¸šåŠ¡æµç¨‹

**ç« èŠ‚æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L182-L203)

### æ—¥å¿—ç›‘æ§

ç³»ç»Ÿæä¾›å…¨é¢çš„æ—¥å¿—ç›‘æ§åŠŸèƒ½ï¼š

```mermaid
flowchart LR
A["æ—¥å¿—æ”¶é›†"] --> B["åº”ç”¨æ—¥å¿—"]
A --> C["ç³»ç»Ÿæ—¥å¿—"]
A --> D["é”™è¯¯æ—¥å¿—"]
B --> E["è¯·æ±‚æ—¥å¿—"]
B --> F["ä¸šåŠ¡æ—¥å¿—"]
C --> G["å®¹å™¨æ—¥å¿—"]
C --> H["æœåŠ¡æ—¥å¿—"]
D --> I["å¼‚å¸¸æ—¥å¿—"]
D --> J["é”™è¯¯æŠ¥å‘Š"]
```

**ç« èŠ‚æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L133-L141)

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼šæœåŠ¡å¯åŠ¨åå¾ˆå¿«åœæ­¢

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./docker-deploy.sh logs

# æ£€æŸ¥ä¾èµ–å®‰è£…
./docker-deploy.sh health

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 8080
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ç«¯å£å†²çª
- éªŒè¯é…ç½®æ–‡ä»¶æ­£ç¡®æ€§
- æ£€æŸ¥ç£ç›˜ç©ºé—´

#### 2. æ•°æ®åº“è¿æ¥é—®é¢˜

**ç—‡çŠ¶**ï¼šæ— æ³•è¿æ¥åˆ°æ•°æ®åº“

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la data/

# éªŒè¯æ•°æ®åº“æ–‡ä»¶å®Œæ•´æ€§
sqlite3 data/xianyu_data.db ".tables"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®å¤æ–‡ä»¶æƒé™
- é‡å»ºæ•°æ®åº“æ–‡ä»¶
- æ¢å¤å¤‡ä»½æ•°æ®

#### 3. å‡çº§å¤±è´¥

**ç—‡çŠ¶**ï¼šå‡çº§è¿‡ç¨‹ä¸­æ–­

**æ¢å¤æ­¥éª¤**ï¼š
```bash
# å›æ»šåˆ°å¤‡ä»½
./docker-deploy.sh stop
cp backups/YYYYMMDD_HHMMSS/xianyu_data.db data/
./docker-deploy.sh start
```

### é”™è¯¯ä»£ç å‚è€ƒ

| é”™è¯¯ä»£ç  | å«ä¹‰ | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| 100 | Dockeræœªå®‰è£… | å®‰è£…Dockerå’ŒDocker Compose |
| 101 | é…ç½®æ–‡ä»¶ç¼ºå¤± | æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§ |
| 102 | ç«¯å£å ç”¨ | æ›´æ¢ç«¯å£æˆ–åœæ­¢å ç”¨è¿›ç¨‹ |
| 103 | æƒé™ä¸è¶³ | ä¿®æ”¹æ–‡ä»¶æƒé™ |
| 104 | ç£ç›˜ç©ºé—´ä¸è¶³ | æ¸…ç†ç£ç›˜ç©ºé—´ |

## å®šæœŸç»´æŠ¤è®¡åˆ’

### ç»´æŠ¤ä»»åŠ¡å®‰æ’

#### æ¯æ—¥ç»´æŠ¤ä»»åŠ¡

```mermaid
graph TD
A["æ¯æ—¥ç»´æŠ¤"] --> B["ç³»ç»ŸçŠ¶æ€æ£€æŸ¥"]
A --> C["æ—¥å¿—æ¸…ç†"]
A --> D["å¤‡ä»½éªŒè¯"]
B --> E["å¥åº·æ£€æŸ¥"]
B --> F["èµ„æºç›‘æ§"]
C --> G["æ—¥å¿—è½®è½¬"]
C --> H["ä¸´æ—¶æ–‡ä»¶æ¸…ç†"]
D --> I["å¤‡ä»½å®Œæ•´æ€§æ£€æŸ¥"]
D --> J["å¤‡ä»½ä¼ è¾“éªŒè¯"]
```

#### æ¯å‘¨ç»´æŠ¤ä»»åŠ¡

1. **ç³»ç»Ÿå¥åº·æ£€æŸ¥**
   ```bash
   # æ‰§è¡Œå…¨é¢å¥åº·æ£€æŸ¥
   ./docker-deploy.sh health
   
   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   ./docker-deploy.sh status
   ```

2. **æ—¥å¿—åˆ†æ**
   ```bash
   # åˆ†æé”™è¯¯æ—¥å¿—
   tail -n 100 logs/error.log
   
   # æ£€æŸ¥ç³»ç»Ÿè­¦å‘Š
   grep WARNING logs/app.log
   ```

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ¸…ç†ä¸´æ—¶æ–‡ä»¶
   - ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
   - æ¸…ç†è¿‡æœŸæ•°æ®

#### æ¯æœˆç»´æŠ¤ä»»åŠ¡

1. **å…¨é¢å¤‡ä»½**
   ```bash
   # æ‰‹åŠ¨åˆ›å»ºå®Œæ•´å¤‡ä»½
   ./docker-deploy.sh backup
   ```

2. **ç³»ç»Ÿå‡çº§**
   ```bash
   # æ£€æŸ¥æ›´æ–°
   git pull
   
   # æ‰§è¡Œå‡çº§
   ./docker-deploy.sh update
   ```

3. **å®¹é‡è§„åˆ’**
   - æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
   - è¯„ä¼°å­˜å‚¨éœ€æ±‚
   - è§„åˆ’æ‰©å®¹æ–¹æ¡ˆ

#### å­£åº¦ç»´æŠ¤ä»»åŠ¡

1. **ç³»ç»Ÿé‡æ„**
   - æ¸…ç†æ— ç”¨æ•°æ®
   - ä¼˜åŒ–æ•°æ®åº“ç»“æ„
   - æ›´æ–°é…ç½®å‚æ•°

2. **å®‰å…¨å®¡è®¡**
   - æ£€æŸ¥å®‰å…¨é…ç½®
   - æ›´æ–°è¯ä¹¦
   - å®¡è®¡è®¿é—®æ—¥å¿—

### ç»´æŠ¤æ£€æŸ¥æ¸…å•

#### å‡çº§å‰æ£€æŸ¥
- [ ] å¤‡ä»½å½“å‰æ•°æ®
- [ ] æ£€æŸ¥ç³»ç»Ÿèµ„æº
- [ ] éªŒè¯é…ç½®æ–‡ä»¶
- [ ] æµ‹è¯•å…³é”®åŠŸèƒ½

#### å‡çº§åéªŒè¯
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] åŠŸèƒ½æµ‹è¯•å®Œæˆ
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] æ—¥å¿—æ— é”™è¯¯

#### æ—¥å¸¸ç›‘æ§æŒ‡æ ‡
- [ ] æœåŠ¡è¿è¡ŒçŠ¶æ€
- [ ] CPUä½¿ç”¨ç‡ < 80%
- [ ] å†…å­˜ä½¿ç”¨ç‡ < 85%
- [ ] ç£ç›˜ç©ºé—´ > 20%
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸

**ç« èŠ‚æ¥æº**
- [docker-deploy.sh](file://docker-deploy.sh#L182-L203)